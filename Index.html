<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>–ú–æ–π –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –î–∞—à–±–æ—Ä–¥</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* –í–°–ï —Å—Ç–∏–ª–∏ –∏ JavaScript –±—É–¥—É—Ç –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ HTML —Ñ–∞–π–ª–∞ */
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #4CAF50;
            --danger: #f44336;
            --warning: #ff9800;
            --info: #2196F3;
            --telegram: #0088cc;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        /* –®–∞–ø–∫–∞ */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–∞—è —Å–µ—Ç–∫–∞ */
        .dashboard {
            padding: 25px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            border: 1px solid #f0f0f0;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-header h2 {
            color: var(--primary);
            margin: 0;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .refresh-btn {
            background: #f8f9fa;
            border: none;
            color: var(--primary);
            padding: 8px 15px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .refresh-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .refresh-all-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .refresh-all-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–µ—Ç–∫–∏ */
        .info-grid {
            display: grid;
            gap: 12px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding-bottom: 12px;
            border-bottom: 1px solid #eee;
        }
        
        .info-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }
        
        .label {
            font-weight: 600;
            color: #666;
            min-width: 150px;
            font-size: 0.95rem;
        }
        
        .value {
            color: #333;
            text-align: right;
            font-weight: 500;
            font-size: 0.95rem;
            max-width: 200px;
            word-break: break-word;
        }
        
        .value.code {
            font-family: 'SF Mono', monospace;
            font-size: 0.85rem;
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 8px;
            border-left: 3px solid var(--primary);
        }
        
        /* –°—Ç–∏–ª–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ */
        .success { color: var(--success); }
        .error { color: var(--danger); }
        .warning { color: var(--warning); }
        .loading { color: #9e9e9e; animation: pulse 1.5s infinite; }
        
        /* Telegram —Å—Ç–∏–ª–∏ */
        .tg-badge {
            background: linear-gradient(135deg, var(--telegram), #00aaff);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .tg-section {
            border: 2px solid var(--telegram);
            background: linear-gradient(135deg, rgba(0, 136, 204, 0.1), rgba(0, 170, 255, 0.05));
        }
        
        .tg-data-item {
            background: rgba(0, 136, 204, 0.1);
            border-left: 4px solid var(--telegram);
        }
        
        /* –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è */
        .permission-request {
            background: #fff8e1;
            border: 2px dashed #ffb300;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
        }
        
        .permission-btn {
            background: linear-gradient(135deg, var(--success), #45a049);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 5px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .permission-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
        
        .permission-btn.small {
            padding: 8px 15px;
            font-size: 0.8rem;
        }
        
        /* –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ */
        .file-input {
            display: none;
        }
        
        .file-label {
            display: block;
            padding: 18px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-align: center;
            margin-bottom: 15px;
            border: 2px dashed rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1.1rem;
        }
        
        .file-label:hover {
            transform: scale(1.02);
        }
        
        .upload-btn, .clear-btn, .save-btn, .export-btn, .danger-btn {
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 5px;
            flex: 1;
        }
        
        .upload-btn { background: var(--success); color: white; }
        .clear-btn { background: var(--warning); color: white; }
        .save-btn { background: var(--info); color: white; }
        .export-btn { background: #9C27B0; color: white; }
        .danger-btn { background: var(--danger); color: white; }
        
        .upload-controls, .save-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        /* –§–∞–π–ª—ã */
        .files-list {
            border: 2px dashed #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            min-height: 100px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .file-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--primary);
        }
        
        /* –§—É—Ç–µ—Ä */
        footer {
            background: #f8f9fa;
            padding: 25px;
            text-align: center;
            border-top: 1px solid #eee;
        }
        
        .timestamp {
            font-size: 0.9rem;
            color: #999;
            margin-top: 10px;
        }
        
        /* Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            max-width: 400px;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .hidden { display: none !important; }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .dashboard { grid-template-columns: 1fr; padding: 15px; }
            header { padding: 20px 15px; }
            header h1 { font-size: 1.8rem; flex-direction: column; }
            .info-item { flex-direction: column; gap: 5px; }
            .label, .value { width: 100%; text-align: left; }
            .upload-controls, .save-controls { flex-direction: column; }
            .permission-btn { width: 100%; margin: 5px 0; }
        }
        
        /* –ü–æ–ª–æ—Å–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <i class="fas fa-user-shield"></i> –ú–æ–π –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –î–∞—à–±–æ—Ä–¥
                <span id="tgBadge" class="tg-badge hidden">
                    <i class="fab fa-telegram"></i> Telegram
                </span>
            </h1>
            <p class="subtitle">–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ</p>
            <button class="refresh-all-btn" onclick="refreshAllData()">
                <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
            </button>
            
            <div id="permissionRequest" class="permission-request hidden">
                <p><i class="fas fa-map-marker-alt"></i> <strong>–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏</strong></p>
                <p>–î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø</p>
                <button onclick="requestLocationPermission()" class="permission-btn">
                    <i class="fas fa-location-dot"></i> –†–∞–∑—Ä–µ—à–∏—Ç—å
                </button>
            </div>
        </header>

        <div class="dashboard">
            <!-- Telegram Web App -->
            <section id="tgSection" class="card tg-section hidden">
                <div class="card-header">
                    <h2><i class="fab fa-telegram"></i> Telegram Web App</h2>
                    <span class="tg-badge">–ë–æ—Ç –¥–∞–Ω–Ω—ã–µ</span>
                </div>
                <div class="info-grid" id="tgData">
                    <div class="info-item tg-data-item">
                        <span class="label">ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</span>
                        <span id="tgUserId" class="value">-</span>
                    </div>
                    <div class="info-item tg-data-item">
                        <span class="label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</span>
                        <span id="tgUsername" class="value">-</span>
                    </div>
                    <div class="info-item tg-data-item">
                        <span class="label">–ò–º—è:</span>
                        <span id="tgFullName" class="value">-</span>
                    </div>
                    <div class="info-item tg-data-item">
                        <span class="label">–Ø–∑—ã–∫:</span>
                        <span id="tgLanguage" class="value">-</span>
                    </div>
                </div>
            </section>

            <!-- –î–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ -->
            <section class="card">
                <div class="card-header">
                    <h2><i class="fas fa-mobile-alt"></i> –î–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h2>
                    <button class="refresh-btn" onclick="refreshDeviceData()">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="label">IP-–∞–¥—Ä–µ—Å:</span>
                        <span id="ip" class="value loading">–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è...</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–ë—Ä–∞—É–∑–µ—Ä:</span>
                        <span id="browser" class="value">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–û–°:</span>
                        <span id="os" class="value">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–≠–∫—Ä–∞–Ω:</span>
                        <span id="screen" class="value">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–Ø–∑—ã–∫:</span>
                        <span id="language" class="value">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å:</span>
                        <span id="timezone" class="value">-</span>
                    </div>
                </div>
            </section>

            <!-- –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –∏ —Å–µ—Ç—å -->
            <section class="card">
                <div class="card-header">
                    <h2><i class="fas fa-map-marker-alt"></i> –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</h2>
                    <div class="location-controls">
                        <button onclick="getExactLocation()" class="refresh-btn">
                            <i class="fas fa-crosshairs"></i>
                        </button>
                    </div>
                </div>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="label">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</span>
                        <span id="location" class="value">
                            <button onclick="requestLocationPermission()" class="permission-btn small">
                                <i class="fas fa-location-dot"></i> –ó–∞–ø—Ä–æ—Å–∏—Ç—å
                            </button>
                        </span>
                    </div>
                    <div class="info-item">
                        <span class="label">–ü–æ IP:</span>
                        <span id="ipLocation" class="value loading">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ...</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</span>
                        <span id="coordinates" class="value">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–ü—Ä–æ–≤–∞–π–¥–µ—Ä:</span>
                        <span id="isp" class="value">-</span>
                    </div>
                </div>
            </section>

            <!-- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ -->
            <section class="card">
                <div class="card-header">
                    <h2><i class="fas fa-microchip"></i> –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ</h2>
                    <button class="refresh-btn" onclick="refreshTechData()">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="label">User Agent:</span>
                        <span id="userAgent" class="value code">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–ü–∞–º—è—Ç—å:</span>
                        <span id="memory" class="value">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–Ø–¥—Ä–∞ CPU:</span>
                        <span id="cpuCores" class="value">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–ë–∞—Ç–∞—Ä–µ—è:</span>
                        <span id="battery" class="value">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–û–Ω–ª–∞–π–Ω:</span>
                        <span id="onlineStatus" class="value success">–î–∞ ‚úì</span>
                    </div>
                </div>
            </section>

            <!-- –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ -->
            <section class="card">
                <div class="card-header">
                    <h2><i class="fas fa-database"></i> –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
                    <button class="refresh-btn" onclick="loadLocalData()">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="label">LocalStorage:</span>
                        <span id="localStorage" class="value success">–î–æ—Å—Ç—É–ø–Ω–æ ‚úì</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ:</span>
                        <span id="storageUsage" class="value">0 KB</span>
                    </div>
                    <div class="info-item">
                        <span class="label">–í—Ä–µ–º—è:</span>
                        <span id="currentTime" class="value">-</span>
                    </div>
                </div>
                <div class="save-controls">
                    <button onclick="saveAllData()" class="save-btn">
                        <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                    <button onclick="exportData()" class="export-btn">
                        <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç
                    </button>
                    <button onclick="clearLocalData()" class="danger-btn">
                        <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                </div>
            </section>
        </div>

        <footer>
            <p><i class="fas fa-info-circle"></i> –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ</p>
            <p class="timestamp" id="lastUpdate"></p>
        </footer>
    </div>

    <div id="toastContainer"></div>

    <script>
        // Telegram Web App
        function detectTelegramWebApp() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã URL –¥–ª—è Telegram Web App
                const urlParams = new URLSearchParams(window.location.search);
                const tgWebAppData = urlParams.get('tgWebAppData');
                
                if (tgWebAppData) {
                    try {
                        const data = JSON.parse(decodeURIComponent(tgWebAppData));
                        showTelegramData(data);
                        return true;
                    } catch (e) {
                        console.log('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö Telegram');
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ö—ç—à URL (Telegram –∏–Ω–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç hash)
                if (window.location.hash && window.location.hash.includes('tgWebAppData')) {
                    const hashData = window.location.hash.split('tgWebAppData=')[1];
                    if (hashData) {
                        try {
                            const data = JSON.parse(decodeURIComponent(hashData));
                            showTelegramData(data);
                            return true;
                        } catch (e) {
                            console.log('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –≤ hash');
                        }
                    }
                }
                
                return false;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ Telegram:', error);
                return false;
            }
        }

        function showTelegramData(data) {
            document.getElementById('tgSection').classList.remove('hidden');
            document.getElementById('tgBadge').classList.remove('hidden');
            
            if (data.user_id) {
                document.getElementById('tgUserId').textContent = data.user_id;
            }
            if (data.username) {
                document.getElementById('tgUsername').textContent = '@' + data.username;
            }
            if (data.first_name) {
                const fullName = `${data.first_name || ''} ${data.last_name || ''}`.trim();
                document.getElementById('tgFullName').textContent = fullName || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            }
            if (data.language_code) {
                document.getElementById('tgLanguage').textContent = data.language_code;
            }
            
            showToast('‚úÖ Telegram Web App –æ–±–Ω–∞—Ä—É–∂–µ–Ω', 'success');
        }

        // –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
        function requestLocationPermission() {
            if (!navigator.geolocation) {
                showToast('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', 'error');
                return;
            }
            
            showToast('üîÑ –ó–∞–ø—Ä–∞—à–∏–≤–∞—é –¥–æ—Å—Ç—É–ø...', 'info');
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    document.getElementById('permissionRequest').classList.add('hidden');
                    updateExactLocation(position);
                    showToast('‚úÖ –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω', 'success');
                },
                (error) => {
                    let message = '–û—à–∏–±–∫–∞: ';
                    switch(error.code) {
                        case 1: message += '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω'; break;
                        case 2: message += '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞'; break;
                        case 3: message += '–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è'; break;
                        default: message += '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
                    }
                    showToast(message, 'error');
                    getIPLocation(); // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –ø–æ IP
                },
                { enableHighAccuracy: true, timeout: 10000 }
            );
        }

        function getExactLocation() {
            if (!navigator.geolocation) return;
            
            navigator.geolocation.getCurrentPosition(
                updateExactLocation,
                () => getIPLocation(),
                { enableHighAccuracy: true }
            );
        }

        function updateExactLocation(position) {
            const lat = position.coords.latitude.toFixed(6);
            const lon = position.coords.longitude.toFixed(6);
            
            document.getElementById('coordinates').textContent = `${lat}, ${lon}`;
            document.getElementById('location').innerHTML = 
                `<span class="success"><i class="fas fa-check-circle"></i> –ü–æ–ª—É—á–µ–Ω–æ</span>`;
            
            // –ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
            getAddressFromCoords(lat, lon);
        }

        async function getIPLocation() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                
                document.getElementById('ipLocation').textContent = 
                    `${data.city || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}, ${data.country_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`;
                document.getElementById('isp').textContent = data.org || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                document.getElementById('ip').textContent = data.ip;
                
                if (data.latitude && data.longitude) {
                    document.getElementById('coordinates').textContent = 
                        `${data.latitude}, ${data.longitude}`;
                }
            } catch (error) {
                document.getElementById('ipLocation').textContent = '–û—à–∏–±–∫–∞';
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è IP:', error);
            }
        }

        async function getAddressFromCoords(lat, lon) {
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=16`,
                    { headers: { 'Accept': 'application/json', 'Accept-Language': 'ru' } }
                );
                const data = await response.json();
                if (data.display_name) {
                    const shortAddress = data.display_name.split(',').slice(0, 2).join(',');
                    document.getElementById('location').innerHTML = 
                        `<span class="success"><i class="fas fa-map-marker-alt"></i> ${shortAddress}</span>`;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞:', error);
            }
        }

        // –î–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        function collectDeviceData() {
            const ua = navigator.userAgent;
            
            // –ë—Ä–∞—É–∑–µ—Ä
            let browser = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
            if (ua.includes('Chrome') && !ua.includes('Edg')) browser = 'Chrome';
            else if (ua.includes('Firefox')) browser = 'Firefox';
            else if (ua.includes('Safari') && !ua.includes('Chrome')) browser = 'Safari';
            else if (ua.includes('Edg')) browser = 'Edge';
            document.getElementById('browser').textContent = browser;
            
            // –û–°
            let os = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è';
            if (ua.includes('Windows')) os = 'Windows';
            else if (ua.includes('Mac')) os = 'macOS';
            else if (ua.includes('Linux')) os = 'Linux';
            else if (ua.includes('Android')) os = 'Android';
            else if (ua.includes('iPhone') || ua.includes('iPad')) os = 'iOS';
            document.getElementById('os').textContent = os;
            
            // –≠–∫—Ä–∞–Ω
            document.getElementById('screen').textContent = 
                `${window.screen.width}√ó${window.screen.height} (${window.devicePixelRatio}x)`;
            
            // –Ø–∑—ã–∫
            document.getElementById('language').textContent = navigator.language;
            
            // –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å
            document.getElementById('timezone').textContent = 
                Intl.DateTimeFormat().resolvedOptions().timeZone;
            
            // User Agent
            document.getElementById('userAgent').textContent = ua.substring(0, 80) + '...';
            
            // –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
            if (navigator.hardwareConcurrency) {
                document.getElementById('cpuCores').textContent = 
                    `${navigator.hardwareConcurrency} —è–¥–µ—Ä`;
            }
            
            if (navigator.deviceMemory) {
                document.getElementById('memory').textContent = 
                    `${navigator.deviceMemory} GB`;
            }
            
            // –ë–∞—Ç–∞—Ä–µ—è
            if ('getBattery' in navigator) {
                navigator.getBattery().then(battery => {
                    const level = Math.round(battery.level * 100);
                    const charging = battery.charging ? '‚ö°' : '';
                    document.getElementById('battery').textContent = `${level}% ${charging}`;
                });
            }
            
            // –û–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å
            document.getElementById('onlineStatus').textContent = 
                navigator.onLine ? '–î–∞ ‚úì' : '–ù–µ—Ç ‚úó';
            document.getElementById('onlineStatus').className = 
                navigator.onLine ? 'value success' : 'value error';
        }

        // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
        function updateStorageInfo() {
            try {
                let total = 0;
                for (let key in localStorage) {
                    if (localStorage.hasOwnProperty(key)) {
                        total += localStorage[key].length * 2;
                    }
                }
                const kb = (total / 1024).toFixed(2);
                document.getElementById('storageUsage').textContent = `${kb} KB`;
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ –ø–∞–º—è—Ç–∏:', e);
            }
        }

        function saveAllData() {
            try {
                const data = {
                    deviceInfo: {
                        browser: document.getElementById('browser').textContent,
                        os: document.getElementById('os').textContent,
                        screen: document.getElementById('screen').textContent,
                        language: document.getElementById('language').textContent,
                        timezone: document.getElementById('timezone').textContent
                    },
                    locationInfo: {
                        ip: document.getElementById('ip').textContent,
                        location: document.getElementById('location').textContent,
                        coordinates: document.getElementById('coordinates').textContent,
                        isp: document.getElementById('isp').textContent
                    },
                    timestamp: new Date().toISOString()
                };
                
                localStorage.setItem('dashboardData', JSON.stringify(data));
                updateStorageInfo();
                showToast('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
            } catch (e) {
                showToast('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
            }
        }

        function loadLocalData() {
            try {
                const saved = localStorage.getItem('dashboardData');
                if (saved) {
                    const data = JSON.parse(saved);
                    showToast('üìÅ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã', 'success');
                }
                updateStorageInfo();
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
            }
        }

        function clearLocalData() {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?')) {
                localStorage.clear();
                updateStorageInfo();
                showToast('üóëÔ∏è –î–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã', 'info');
            }
        }

        function exportData() {
            try {
                const allData = {};
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    try {
                        allData[key] = JSON.parse(localStorage.getItem(key));
                    } catch {
                        allData[key] = localStorage.getItem(key);
                    }
                }
                
                const blob = new Blob([JSON.stringify(allData, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `dashboard-data-${new Date().toISOString().slice(0,10)}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                showToast('üì§ –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
            } catch (e) {
                showToast('‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞', 'error');
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function updateTimestamp() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = 
                `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${now.toLocaleString('ru-RU')}`;
        }

        function updateTime() {
            document.getElementById('currentTime').textContent = 
                new Date().toLocaleTimeString('ru-RU');
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            toast.style.background = 
                type === 'success' ? '#4CAF50' :
                type === 'error' ? '#f44336' :
                type === 'warning' ? '#ff9800' : '#333';
            
            document.getElementById('toastContainer').appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram
            detectTelegramWebApp();
            
            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            collectDeviceData();
            getIPLocation();
            updateTimestamp();
            updateTime();
            updateStorageInfo();
            
            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            setInterval(updateTime, 1000);
            setInterval(updateTimestamp, 60000);
            setInterval(getIPLocation, 300000); // –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
            
            // –°–ª—É—à–∞–µ–º –æ–Ω–ª–∞–π–Ω/–æ—Ñ–ª–∞–π–Ω
            window.addEventListener('online', () => {
                document.getElementById('onlineStatus').textContent = '–î–∞ ‚úì';
                document.getElementById('onlineStatus').className = 'value success';
                showToast('üåê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'success');
            });
            
            window.addEventListener('offline', () => {
                document.getElementById('onlineStatus').textContent = '–ù–µ—Ç ‚úó';
                document.getElementById('onlineStatus').className = 'value error';
                showToast('‚ö†Ô∏è –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'warning');
            });
            
            console.log('üöÄ –î–∞—à–±–æ—Ä–¥ –∑–∞–ø—É—â–µ–Ω!');
        });

        // –§—É–Ω–∫—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        function refreshDeviceData() {
            document.querySelectorAll('#deviceData .value').forEach(el => {
                el.classList.add('loading');
            });
            setTimeout(() => {
                collectDeviceData();
                showToast('üì± –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
            }, 500);
        }

        function refreshTechData() {
            document.querySelectorAll('#techData .value').forEach(el => {
                el.classList.add('loading');
            });
            setTimeout(() => {
                collectDeviceData(); // –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é
                showToast('‚öôÔ∏è –¢–µ—Ö. –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
            }, 500);
        }

        function refreshAllData() {
            refreshDeviceData();
            getIPLocation();
            updateTimestamp();
            updateStorageInfo();
            showToast('üîÑ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
        }
    </script>
</body>
</html>
